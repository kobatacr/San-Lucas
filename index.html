<!DOCTYPE html>
  <html>
    <head>

      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Refugio Nacional de Vida Silvestre Isla San Lucas - Kṍbata Costa Rica</title>
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
      <link rel="stylesheet" href="Lib/Control.MiniMap.css">
      <link rel="stylesheet" href="Lib/L.Control.MousePosition.css">
      <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
      <script src="http://maps.google.com/maps/api/js?v=3.26&sensor=false"></script>
      <script type="text/javascript" src="Lib/Leaflet.GoogleMutant.js"></script>
      <script type="text/javascript" src="Lib/Control.MiniMap.js"></script>
      <script type="text/javascript" src= "Lib/L.Control.MousePosition.js"></script>
      <script type="text/javascript" src="Data/Layers/Puntos.js"></script>
      <script type="text/javascript" src="Data/Layers/Rutas.js"></script>


    <!--CSS modificado-->
      <style type="text/css">

        html, body {
       height:100%;
       margin: 0;
       padding: 0;
      }
        #map {
          height:100%;
      }

      .leaflet-popup-content-wrapper,
      .leaflet-popup-tip {
        background: #94D794;
        }

      .leaflet-popup-content-wrapper {
      text-align: center;
      border-radius: 12px;
      }

      .leaflet-popup-content {
      line-height: 1.4;
      }

      </style>

    </head>

    <body>
     
      <div id="map"></div>
     
      <script>
     
    // inicio del mapa
      var map = L.map('map').setView([9.943, -84.906], 15);
    //--------------------------------------------------
     
    // Basemap
      var googleLayer = new L.GridLayer.GoogleMutant();

      map.addLayer(googleLayer);

      var ESRI2 = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', 
      {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012',
        maxZoom:16,
        minZoom:14
      });

      /*var imageUrl = 'http://www.enchanting-costarica.com/wp-content/uploads/2013/06/San-Lucas-Island-boat-dock.jpg',
      imageBounds = [[9.92469, -84.93836], [9.96133, -84.87512]];
      L.imageOverlay(imageUrl, imageBounds).addTo(map);*/

    //---------------------------------------------------------------

    // Elimina ancho máximo del popup
      var cambio = {

        'maxWidth': 'none'
      };

    //-------------------------------------------
    //Función popup de los puntos de playa.

    function popup_puntos(feature, layer) {
      layer.bindPopup('<b>' + feature.properties.Nombre_1 + '</b>' + '<br>' + '<br>' + 'CONTENIDO DINÁMICO' + '<br>' + '<br>' + 'Prueba', cambio);
    }


    //Función popup de las rutas.

    function popup_rutas(feature, layer) {
      layer.bindPopup('<iframe width="40" height="40" frameborder="0" src="Data/Icons/Send.png"></iframe>' + '<br>' + '<b>' + feature.properties.Nombre_1 + '</b>' + '<br>' + 'Duración: ' + feature.properties.Duracion + ' minutos.' + '<br>' + '<br>' + 'CONTENIDO DINÁMICO' + '<br>' + '<br>' + 'Prueba', cambio);
    }

    //--------------------------------------------
    // Función estilo rutas.

      function getColor(x) {
        return x == 5     ?    '#bd0026':
               x == 10     ?   '#f03b20':
               x == 30     ?   '#fd8d3c':
               x == 45     ?   '#fecc5c':
                        '#ffffff'
          };

    //---------------------------------------------
    // Filtros

      function filtro_CGP(feature, layer) {
        if(feature.properties.ID === 1) return true;
      };

      function filtro_CH(feature, layer) {
        if(feature.properties.ID === 2) return true;
      };

      function filtro_Playa(feature, layer) {
        if(feature.properties.ID === 3) return true;
      };

      function filtro_Entrada(feature, layer) {
        if(feature.properties.ID === 4) return true;
      };

    //-----------------------------------------------

    // Ícono, llama capar y función.

      // 1) Rutas  
      var Rutas = L.geoJson(Rut, {
        onEachFeature: popup_rutas,
        style: function (feature) {
          return {
            'color': getColor (feature.properties.Duracion),
            'opacity': 0.7,
            'weight': 3
          }
        }
      }).addTo(map);

      // 2) Casa Guardaparques
      var Img1 = L.icon({
        iconUrl: 'Data/Icons/CGP.png',
        iconSize: [30, 30]
      });

      L.geoJson(Punt, {
        pointToLayer: function(feature,latlng){
        return L.marker(latlng, {icon: Img1});
        },
        onEachFeature: popup_puntos,
        filter: filtro_CGP
      }).addTo(map);

      // 3) Centros históricos
      var Img2 = L.icon({
        iconUrl: 'Data/Icons/Obs.png',
        iconSize: [30, 30]
      });

      L.geoJson(Punt, {
        pointToLayer: function(feature,latlng){
        return L.marker(latlng, {icon: Img2});
        },
        onEachFeature: popup_puntos,
        filter: filtro_CH
      }).addTo(map);

      // 4) Playas
      var Img3 = L.icon({
        iconUrl: 'Data/Icons/Playa.png',
        iconSize: [30, 30]
      });

      L.geoJson(Punt, {
        pointToLayer: function(feature,latlng){
        return L.marker(latlng, {icon: Img3});
        },
        onEachFeature: popup_puntos,
        filter: filtro_Playa
      }).addTo(map);

      // 5) Entrada (Cambiar ícono)
      var Img4 = L.icon({
        iconUrl: 'Data/Icons/Obs.png',
        iconSize: [30, 30]
      });

      L.geoJson(Punt, {
        pointToLayer: function(feature,latlng){
        return L.marker(latlng, {icon: Img4});
        },
        onEachFeature: popup_puntos,
        filter: filtro_Entrada
      }).addTo(map);      

      //----------------------------------------------------------------

      //Layers Control (¡¡REVISAR!!)
      /*var baseMaps = {
              'Google Earth' : googleLayer,
              'ESRI' : ESRI2
          };

      var overlayMaps = {
              'Puntos' : Puntos,
              'Rutas' : Rutas 
          };

      L.control.layers(baseMaps, overlayMaps, {collapsed:false}).addTo(map);*/
      //--------------------------------------------------------------------

      //MiniMap

      /*var OSM = new L.TileLayer ('http://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}', {
        maxZoom:16});

      var miniMap = new L.Control.MiniMap(OSM, {toggleDisplay:true}).addTo(map);*/

      //------------------------------------------------------

      // Escala y posición del mouse.

      L.control.scale().addTo(map);

      //L.control.mousePosition().addTo(map);

    //-------------------------------------------------

      </script>
    </body>
  </html>

